# Implementation Plan: File Attachment Handling

**Branch**: `001-teams-file-upload` | **Date**: 2026-01-06 | **Spec**: [specs/001-teams-file-upload/spec.md](specs/001-teams-file-upload/spec.md)
**Input**: Feature specification from `specs/001-teams-file-upload/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

The primary requirement is to implement direct file attachment handling within the Teams bot. Unlike the previous design, this feature will skip the `FileConsentCard` and Microsoft Graph API integrations. Instead, when a user sends a message with one or more files, the bot will automatically extract metadata (filename, MIME type, and temporary download URL) from the message activity. The bot will validate if the files are supported (PDF, DOC, DOCX), log the action, and provide immediate feedback to the user via a response message. The logic will be implemented in a shared utility or manager to ensure it can be reused by multiple bot classes such as `FoundryBot`.

## Technical Context

**Language/Version**: Python 3.10+ (as indicated by `requirements.txt`)  
**Primary Dependencies**: `botbuilder-core`, `botbuilder-schema`, `botbuilder-integration-aiohttp`  
**Storage**: N/A (requirements explicitly state to remove upload state recording)  
**Testing**: Manual Testing (feature requires Teams environment)  
**Target Platform**: Microsoft Teams via Bot Framework
**Project Type**: single (shared module architecture)  
**Performance Goals**: User feedback delivered within 2 seconds of message receipt (SC-002)  
**Constraints**: No use of Microsoft Graph API; No `FileConsentCard`; No special "upload" command required.  
**Scale/Scope**: Apply to `FoundryBot` with shared logic in `src/utils/genie_manager.py` or new `src/utils/file_handler.py`.

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

| Principle                       | Status | Implementation Plan                                                                         |
| ------------------------------- | ------ | ------------------------------------------------------------------------------------------- |
| **Code Quality**                | ✅     | Implement logic in shared utility modules to maximize reusability across bots.              |
| **Testing Standards**           | ✅     | Manual verification in Teams sandbox environment after deployment to ensure integration.    |
| **User Experience Consistency** | ✅     | Automated detection of attachments ensures a seamless "drag-and-drop" experience for users. |
| **Performance Requirements**    | ✅     | Minimal external API calls (skipping Graph API) ensures meeting the 2s response goal.       |

## Project Structure

### Documentation (this feature)

```text
specs/001-teams-file-upload/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output (generated by separate command)
```

### Source Code (repository root)

```text
src/
├── app.py
├── bot/
│   ├── base_bot.py      # Potentially update to include attachment handling hook
│   ├── foundry_bot.py   # Implement file handling
│   └── genie_bot.py
├── utils/
│   ├── file_handler.py  # NEW: Shared logic for file validation and metadata extraction
│   └── genie_manager.py # Update for file metadata processing
└── core/
    └── logger_config.py # Use for logging successful attachments
```

**Structure Decision**: Single project structure. shared logic will be hosted in `src/utils` to maintain bot class simplicity and reusability.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation                  | Why Needed         | Simpler Alternative Rejected Because |
| -------------------------- | ------------------ | ------------------------------------ |
| [e.g., 4th project]        | [current need]     | [why 3 projects insufficient]        |
| [e.g., Repository pattern] | [specific problem] | [why direct DB access insufficient]  |
